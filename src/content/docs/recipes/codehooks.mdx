---
title: Custom Code Hooks
description: Extend your TractStack site with custom components and dynamic functionality
---

import { FileTree } from "@astrojs/starlight/components";

Tract Stack is designed as a content-first, no-code experience. However, there are scenarios where custom code enhances your site - pricing tables, hero sections, interactive widgets, or specialized functionality may warrant a custom touch.

## How Code Hooks Work

Story fragments (web pages) can include custom components through the CodeHook system. When you add a code element to your content and specify a target, TractStack dispatches to your custom component.

## Project Structure

Your TractStack project includes a `src/custom/` folder for customizations:

<FileTree>
- src/custom/
 - CodeHook.astro Component dispatcher
 - CustomRoutes.astro Custom page routes
 - CustomHero.astro Example component
 - pages/
   - Collections.astro Example route handler
</FileTree>

## CodeHook Dispatcher

The `CodeHook.astro` file acts as a central dispatcher for all custom components:

### With Examples (Full Version)

```js
---
// V2 CodeHook Dispatcher - With Examples
import CustomHero from './CustomHero.astro';
import FeaturedContent from '@/components/codehooks/FeaturedContent.astro';
import ListContent from '@/components/codehooks/ListContent.astro';
import BunnyVideoWrapper from '@/components/codehooks/BunnyVideoWrapper.astro';
import EpinetWrapper from '@/components/codehooks/EpinetWrapper';
import type { FullContentMapItem } from '@/types/tractstack';

export interface Props {
  target: string;
  fullContentMap: FullContentMapItem[];
  options?: {
    params?: {
      options?: string;
    };
  };
}

const { target, options, fullContentMap } = Astro.props;

export const components = {
  'custom-hero': true,
  'featured-content': true,
  'list-content': true,
  'bunny-video': true,
  epinet: true,
};
---

{
  target === 'list-content' ? (
    <ListContent options={options} contentMap={fullContentMap} />
  ) : target === 'featured-content' ? (
    <FeaturedContent options={options} contentMap={fullContentMap} />
  ) : target === 'bunny-video' ? (
    <BunnyVideoWrapper options={options} />
  ) : target === 'custom-hero' ? (
    <CustomHero />
  ) : target === 'epinet' ? (
    <EpinetWrapper fullContentMap={fullContentMap} client:only="react" />
  ) : (
    <div class="rounded-lg bg-gray-50 p-8 text-center">
      <p class="text-gray-600">CodeHook target "{target}" not found</p>
    </div>
  )
}
```

### Minimal Version (No Examples)

```js
---
// CodeHook Dispatcher - Minimal Version
import FeaturedContent from '@/components/codehooks/FeaturedContent.astro';
import ListContent from '@/components/codehooks/ListContent.astro';
import BunnyVideoWrapper from '@/components/codehooks/BunnyVideoWrapper.astro';
import EpinetWrapper from '@/components/codehooks/EpinetWrapper';
// import CustomHero from './CustomHero.astro';  // Uncomment to add

export const components = {
  'featured-content': true,
  'list-content': true,
  'bunny-video': true,
  epinet: true,
  // "custom-hero": true,  // Uncomment when you create CustomHero.astro
};

const { target, options, fullContentMap } = Astro.props;
---

{
  target === 'list-content' ? (
    <ListContent options={options} contentMap={fullContentMap} />
  ) : target === 'featured-content' ? (
    <FeaturedContent options={options} contentMap={fullContentMap} />
  ) : target === 'bunny-video' ? (
    <BunnyVideoWrapper options={options} />
  ) : target === 'epinet' ? (
    <EpinetWrapper fullContentMap={fullContentMap} client:only="react" />
  ) /* : target === "custom-hero" ? (
    <CustomHero />
  ) */ : (
    <div class="rounded-lg bg-gray-50 p-8 text-center">
      <p class="text-gray-600">CodeHook target "{target}" not found</p>
      <p class="mt-2 text-sm text-gray-500">
        Available: list-content, featured-content, bunny-video, epinet
      </p>
    </div>
  )
}
```

## Built-in Framework Components

TractStack includes several framework components available out-of-the-box:

### FeaturedContent

- Displays curated content from your site
- Automatically uses `fullContentMap` data
- Customizable through `options` parameter

### ListContent

- Creates dynamic content listings
- Integrates with site content management
- Supports filtering and sorting

### BunnyVideoWrapper

- Video player integration with Bunny.net CDN
- Optimized streaming and delivery
- Responsive design

### EpinetWrapper

- Analytics and engagement tracking component
- React-based interactive element
- Requires `client:only="react"` directive

## Creating Custom Components

### 1. Create Your Component

Create `src/custom/CustomHero.astro`:

```js
---
// Custom Hero Component Example
---

<div class="flex h-80 items-center justify-center bg-yellow-300">
  <div class="text-center">
    <h1 class="mb-4 text-4xl font-bold text-gray-900">Custom Hero Component</h1>
    <p class="text-lg text-gray-700">This is an example CodeHook component</p>
    <p class="mt-2 text-sm text-gray-600">
      Edit this in src/custom/CustomHero.astro
    </p>
  </div>
</div>
```

### 2. Register in CodeHook Dispatcher

Add to `src/custom/CodeHook.astro`:

1. **Import your component**:

   ```js
   import CustomHero from "./CustomHero.astro";
   ```

2. **Add to components object**:

   ```js
   export const components = {
     "custom-hero": true,
     // ... other components
   };
   ```

3. **Add to dispatcher logic**:
   ```js
   target === 'custom-hero' ? (
     <CustomHero />
   ) :
   ```

### 3. Use in Content

In StoryKeep, add a code element with:

- **Target**: `custom-hero`
- **Content**: Will render your custom component

## Custom Routes

For more complex functionality, create custom page routes:

### CustomRoutes.astro

```js
---
// V2 Custom Routes - With Examples
import Collections from './pages/Collections.astro';

export interface Props {
  route: string;
  slug: string;
  resources: any[];
  variation?: string;
}

const { route, slug, resources } = Astro.props;

export const routes = {
  collections: true,
};

// V2: Resources are already filtered by backend
const payload = resources;
---

{
  route === 'collections' ? (
    <Collections route={route} slug={slug} resources={payload} />
  ) : (
    <div class="rounded-lg bg-gray-50 p-8 text-center">
      <p class="text-gray-600">Custom route "{route}" not found</p>
    </div>
  )
}
```

### Collections Example

The collections route demonstrates dynamic page creation:

- **URL Pattern**: `/collections/[slug]`
- **Data Integration**: Uses filtered resources from backend
- **Layout**: Full page layout with header/footer
- **Content**: Dynamic resource display based on slug

## Component Props and Data

### Available Props

CodeHook components receive:

```typescript
interface Props {
  target: string; // Component identifier
  fullContentMap: FullContentMapItem[]; // Site content data
  options?: {
    // Optional configuration
    params?: {
      options?: string;
    };
  };
}
```

### Content Map Integration

Access site content through `fullContentMap`:

- All pages and content items
- Metadata and relationships
- Dynamic content filtering
- SEO and social data

## Development Workflow

### 1. Plan Your Component

- Identify the functionality needed
- Consider data requirements
- Plan integration points

### 2. Create and Test

- Build component in `src/custom/`
- Register in dispatcher
- Test through StoryKeep content editor

### 3. Deploy

- Components deploy with your site
- No additional build steps required
- Hot reloading during development

## Best Practices

### Component Design

- **Keep it simple**: Focus on specific functionality
- **Use Tailwind CSS**: Leverage the existing design system
- **Handle errors gracefully**: Provide fallbacks for missing data

### Performance

- **Lazy loading**: Use `client:only` for React components when needed
- **Optimize imports**: Only import what you need
- **Cache considerations**: Framework components are cached efficiently

### Maintainability

- **Clear naming**: Use descriptive component and target names
- **Documentation**: Comment complex logic
- **Version control**: Track custom components in your repository

Custom CodeHooks provide the flexibility to extend TractStack's content-first approach with precisely the custom functionality your site needs, while maintaining the system's performance and content management advantages.

---

_Edit `src/custom/CodeHook.astro` to register your custom components and unlock unlimited customization possibilities._
